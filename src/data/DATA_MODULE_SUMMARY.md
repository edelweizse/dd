# `src/data` Module Summary

This document summarizes the current data pipeline and split semantics.

## Scope

- `src/data/processing.py`
- `src/data/graph.py`
- `src/data/splits.py`
- `src/data/__init__.py` (re-export surface)

## End-to-End Flow

1. Load and normalize raw CTD/PPI sources.
2. Build core entities (`chemical`, `disease`, `gene`) and optional extended entities (`pathway`, `go_term`).
3. Build typed edge tables with engineered edge attributes.
4. Persist processed parquet artifacts.
5. Build a heterogeneous PyG graph (`HeteroData`) from processed tables.
6. Optionally add reverse edge types for message passing.
7. Split CD edges into train/val/test (`stratified` or `random`).
8. Optionally rebalance train split to improve train-node coverage (best effort).
9. Save/load split artifacts for strict reuse.
10. Build loaders and split-aware known-positive filters.
11. Perform batch-local negative sampling with collision rejection.

## Processing Semantics

- IDs are normalized to contiguous internal IDs for graph tensors.
- Extended nodes/edges are optional at graph-build time (`include_extended`).
- Edge attributes include categorical and continuous evidence/enrichment signals.

## Graph Semantics

- `build_graph_from_processed(...)` is the high-level entrypoint used by scripts.
- Reverse edges are optional but enabled in training/eval/inference script paths by default.
- Graph summary utilities expose per-node/per-edge counts and edge-attr availability.

## Split + Loader Semantics

- Split artifacts store edge indices plus metadata (ratios, seed, strategy, graph shape markers).
- `prepare_splits_and_loaders(...)` either:
  - loads an artifact and validates compatibility, or
  - creates a new split and can persist it.
- One train CD graph is used for neighbor sampling; val/test use different supervision labels on that graph.
- Phase-specific known positives are used to prevent leakage in negative sampling/evaluation.

## Negative Sampling

- Negatives are generated by corrupting exactly one endpoint (chemical or disease).
- Sampler rejects known positives and retries boundedly.
- Degree-biased hard-negative sampling is supported via configurable ratios/weights.

## Reproducibility Expectations

- For reproducible experiments, generate one split artifact and reuse it in:
  - `scripts.train`
  - `scripts.evaluate`
  - `scripts.compare_baselines`
  - smoke/e2e scripts

## Practical Caveats

- Graph schema must stay consistent across artifact creation and downstream usage.
- `include_extended` choice must match model/checkpoint expectations in downstream scripts.
